{
	"name": "PHDayCons",
	"properties": {
		"description": "This code is written to read daily Parquet files and perform the transformation to create Table for DayConsolidated at Portfolio level.",
		"folder": {
			"name": "Phelan"
		},
		"nbformat": 4,
		"nbformat_minor": 2,
		"bigDataPool": {
			"referenceName": "sapienta",
			"type": "BigDataPoolReference"
		},
		"sessionProperties": {
			"driverMemory": "56g",
			"driverCores": 8,
			"executorMemory": "56g",
			"executorCores": 8,
			"numExecutors": 2,
			"runAsWorkspaceSystemIdentity": false,
			"conf": {
				"spark.dynamicAllocation.enabled": "false",
				"spark.dynamicAllocation.minExecutors": "2",
				"spark.dynamicAllocation.maxExecutors": "2",
				"spark.autotune.trackingId": "2d13e454-23c9-4a22-b58c-71fecd64966e"
			}
		},
		"metadata": {
			"saveOutput": true,
			"synapse_widget": {
				"version": "0.1",
				"state": {
					"c1e53ed1-0c0e-4c58-a1d1-f93f770cc045": {
						"type": "Synapse.DataFrame",
						"sync_state": {
							"table": {
								"rows": [
									{
										"0": "Phelan50MW",
										"1": "2022-06-30 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.4",
										"5": "358.5",
										"6": "35.75",
										"7": "36.98",
										"8": "48.41",
										"9": "54.69",
										"10": "0.0",
										"11": "6.349999904632568",
										"12": "35.98859405517578",
										"13": "46.27711486816406",
										"14": "47.514705657958984",
										"15": "366.586701171875",
										"16": "49.52000045776367",
										"17": "364.4100036621094",
										"18": "0.0",
										"19": "99.76000213623047",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-01 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.67",
										"5": "371.8",
										"6": "36.42",
										"7": "37.67",
										"8": "48.67",
										"9": "55.54",
										"10": "0.0",
										"11": "3.049999952316284",
										"12": "33.926876068115234",
										"13": "40.82211685180664",
										"14": "53.919517517089844",
										"15": "193.67059765625",
										"16": "50.34000015258789",
										"17": "192.58999633789062",
										"18": "0.0",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-02 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "4.66",
										"5": "265.0",
										"6": "36.6",
										"7": "37.23",
										"8": "44.98",
										"9": "48.53",
										"10": "0.0",
										"11": "1.5800000429153442",
										"12": "29.426029205322266",
										"13": "33.61805725097656",
										"14": "82.37576293945312",
										"15": "105.30389892578125",
										"16": "24.43000030517578",
										"17": "104.51000213623047",
										"18": "0.0",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-03 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "5.77",
										"5": "323.2",
										"6": "37.5",
										"7": "38.64",
										"8": "48.9",
										"9": "54.7",
										"10": "0.0",
										"11": "3.3299999237060547",
										"12": "31.393028259277344",
										"13": "39.66769027709961",
										"14": "71.15559387207031",
										"15": "202.5662001953125",
										"16": "47.25",
										"17": "201.50999450683594",
										"18": "0.0",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-04 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "5.33",
										"5": "306.3",
										"6": "34.59",
										"7": "35.41",
										"8": "45.01",
										"9": "48.94",
										"10": "0.0",
										"11": "4.050000190734863",
										"12": "31.084354400634766",
										"13": "41.00067138671875",
										"14": "75.83340454101562",
										"15": "228.547599609375",
										"16": "50.33000183105469",
										"17": "227.19000244140625",
										"18": "0.0",
										"19": "99.5999984741211",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-05 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.67",
										"5": "376.1",
										"6": "34.96",
										"7": "36.12",
										"8": "47.2",
										"9": "53.55",
										"10": "0.0",
										"11": "7.099999904632568",
										"12": "36.37690353393555",
										"13": "48.64009475708008",
										"14": "55.368526458740234",
										"15": "386.229",
										"16": "50.66999816894531",
										"17": "383.7900085449219",
										"18": "0.0",
										"19": "99.33999633789062",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-06 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.77",
										"5": "383.2",
										"6": "34.14",
										"7": "35.27",
										"8": "46.56",
										"9": "52.85",
										"10": "0.0",
										"11": "6.860000133514404",
										"12": "37.25703048706055",
										"13": "45.79341125488281",
										"14": "53.23557662963867",
										"15": "390.194298828125",
										"16": "49.86000061035156",
										"17": "387.82000732421875",
										"18": "0.5",
										"19": "99.81999969482422",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-07 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "4.8",
										"5": "275.6",
										"6": "35.0",
										"7": "35.8",
										"8": "44.33",
										"9": "48.02",
										"10": "0.0",
										"11": "5.03000020980835",
										"12": "34.19352340698242",
										"13": "41.33350372314453",
										"14": "61.613765716552734",
										"15": "290.20369921875",
										"16": "51.15999984741211",
										"17": "288.6000061035156",
										"18": "0.0",
										"19": "99.76000213623047",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-08 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "4.15",
										"5": "237.3",
										"6": "35.9",
										"7": "36.47",
										"8": "43.89",
										"9": "46.33",
										"10": "0.0",
										"11": "6.179999828338623",
										"12": "33.96603012084961",
										"13": "46.697513580322266",
										"14": "62.695804595947266",
										"15": "336.5346015625",
										"16": "51.650001525878906",
										"17": "334.4800109863281",
										"18": "0.0",
										"19": "99.97000122070312",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-09 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "4.8",
										"5": "267.2",
										"6": "40.97",
										"7": "41.82",
										"8": "50.36",
										"9": "54.18",
										"10": "0.0",
										"11": "6.289999961853027",
										"12": "35.23454666137695",
										"13": "47.76019287109375",
										"14": "58.0338249206543",
										"15": "350.827099609375",
										"16": "51.52000045776367",
										"17": "349.0400085449219",
										"18": "0.0",
										"19": "99.9000015258789",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-10 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.87",
										"5": "384.0",
										"6": "36.72",
										"7": "37.73",
										"8": "49.35",
										"9": "55.49",
										"10": "0.0",
										"11": "5.150000095367432",
										"12": "33.03766632080078",
										"13": "44.11099624633789",
										"14": "58.902103424072266",
										"15": "293.74380078125",
										"16": "51.560001373291016",
										"17": "292.07000732421875",
										"18": "0.0",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-11 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.82",
										"5": "382.0",
										"6": "36.26",
										"7": "37.45",
										"8": "49.76",
										"9": "55.25",
										"10": "0.0",
										"11": "4.820000171661377",
										"12": "33.29828643798828",
										"13": "44.251914978027344",
										"14": "61.28337860107422",
										"15": "279.622595703125",
										"16": "50.869998931884766",
										"17": "278.4100036621094",
										"18": "0.0",
										"19": "99.9800033569336",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-12 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.49",
										"5": "365.6",
										"6": "35.88",
										"7": "36.99",
										"8": "48.7",
										"9": "53.94",
										"10": "0.0",
										"11": "6.739999771118164",
										"12": "34.84885787963867",
										"13": "49.61865997314453",
										"14": "56.220191955566406",
										"15": "366.14780078125",
										"16": "50.9900016784668",
										"17": "363.82000732421875",
										"18": "0.0",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-13 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.27",
										"5": "353.7",
										"6": "35.55",
										"7": "36.7",
										"8": "47.91",
										"9": "53.33",
										"10": "0.0",
										"11": "6.28000020980835",
										"12": "35.54338073730469",
										"13": "48.39632034301758",
										"14": "51.36994934082031",
										"15": "349.1093984375",
										"16": "51.54999923706055",
										"17": "346.8800048828125",
										"18": "0.0",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-14 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "2.41",
										"5": "139.6",
										"6": "31.29",
										"7": "31.61",
										"8": "35.88",
										"9": "37.61",
										"10": "0.0",
										"11": "5.710000038146973",
										"12": "32.70833206176758",
										"13": "42.15104675292969",
										"14": "65.54224395751953",
										"15": "320.09019921875",
										"16": "51.59000015258789",
										"17": "318.2300109863281",
										"18": "0.5",
										"19": "99.95999908447266",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-15 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "3.48",
										"5": "203.1",
										"6": "30.89",
										"7": "31.88",
										"8": "37.6",
										"9": "41.94",
										"10": "0.0",
										"11": "3.4600000381469727",
										"12": "30.455284118652344",
										"13": "35.06976318359375",
										"14": "74.79476165771484",
										"15": "210.204599609375",
										"16": "52.40999984741211",
										"17": "209.07000732421875",
										"18": "0.0",
										"19": "97.7300033569336",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-16 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "5.49",
										"5": "316.7",
										"6": "32.49",
										"7": "33.71",
										"8": "43.23",
										"9": "48.29",
										"10": "0.0",
										"11": "4.190000057220459",
										"12": "31.33571434020996",
										"13": "37.4388542175293",
										"14": "72.75399780273438",
										"15": "238.3010986328125",
										"16": "52.2599983215332",
										"17": "237.22000122070312",
										"18": "0.5",
										"19": "99.7699966430664",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-17 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "4.47",
										"5": "254.8",
										"6": "33.45",
										"7": "34.55",
										"8": "41.52",
										"9": "47.83",
										"10": "0.0",
										"11": "4.130000114440918",
										"12": "28.656219482421875",
										"13": "36.50215530395508",
										"14": "84.19635772705078",
										"15": "226.94030078125",
										"16": "53.04999923706055",
										"17": "225.08999633789062",
										"18": "0.6000000238418579",
										"19": "99.76000213623047",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-18 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.34",
										"5": "357.5",
										"6": "36.33",
										"7": "37.52",
										"8": "48.86",
										"9": "53.95",
										"10": "0.0",
										"11": "5.539999961853027",
										"12": "32.48276138305664",
										"13": "45.807430267333984",
										"14": "70.74385833740234",
										"15": "313.45559765625",
										"16": "52.150001525878906",
										"17": "311.55999755859375",
										"18": "0.6000000238418579",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-19 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "5.09",
										"5": "287.2",
										"6": "35.57",
										"7": "36.87",
										"8": "44.82",
										"9": "51.5",
										"10": "0.0",
										"11": "5.150000095367432",
										"12": "32.966346740722656",
										"13": "43.668582916259766",
										"14": "70.97607421875",
										"15": "290.571099609375",
										"16": "52.04999923706055",
										"17": "288.5299987792969",
										"18": "0.0",
										"19": "99.55000305175781",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-20 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.43",
										"5": "366.0",
										"6": "33.49",
										"7": "34.7",
										"8": "46.18",
										"9": "51.77",
										"10": "0.0",
										"11": "6.739999771118164",
										"12": "34.30545425415039",
										"13": "45.796356201171875",
										"14": "56.15593338012695",
										"15": "389.0675",
										"16": "51.369998931884766",
										"17": "386.69000244140625",
										"18": "0.5",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-21 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.59",
										"5": "363.0",
										"6": "39.86",
										"7": "41.25",
										"8": "52.96",
										"9": "58.79",
										"10": "0.0",
										"11": "4.71999979019165",
										"12": "33.01557540893555",
										"13": "41.26268768310547",
										"14": "59.09833526611328",
										"15": "280.9236015625",
										"16": "53.47999954223633",
										"17": "279.5",
										"18": "0.0",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-22 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "7.03",
										"5": "389.6",
										"6": "37.77",
										"7": "39.03",
										"8": "51.75",
										"9": "57.62",
										"10": "0.0",
										"11": "4.769999980926514",
										"12": "31.59671401977539",
										"13": "42.71091079711914",
										"14": "68.75018310546875",
										"15": "289.60509765625",
										"16": "50.150001525878906",
										"17": "288.2200012207031",
										"18": "0.0",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-23 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.82",
										"5": "378.3",
										"6": "37.44",
										"7": "38.87",
										"8": "50.97",
										"9": "57.14",
										"10": "0.009999999776482582",
										"11": "3.5899999141693115",
										"12": "29.785694122314453",
										"13": "39.59033966064453",
										"14": "78.12531280517578",
										"15": "205.7114013671875",
										"16": "50.4900016784668",
										"17": "204.44000244140625",
										"18": "0.5",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-24 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.79",
										"5": "381.1",
										"6": "35.44",
										"7": "36.76",
										"8": "48.89",
										"9": "54.8",
										"10": "5.860000133514404",
										"11": "6.059999942779541",
										"12": "31.153507232666016",
										"13": "40.100669860839844",
										"14": "74.01933288574219",
										"15": "344.27809765625",
										"16": "51.33000183105469",
										"17": "342.5400085449219",
										"18": "0.5",
										"19": "96.76000213623047",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-25 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "4.38",
										"5": "253.3",
										"6": "33.1",
										"7": "33.93",
										"8": "41.57",
										"9": "45.25",
										"10": "4.909999847412109",
										"11": "5.300000190734863",
										"12": "31.434877395629883",
										"13": "41.48087692260742",
										"14": "69.6890869140625",
										"15": "303.542296875",
										"16": "51.02000045776367",
										"17": "301.80999755859375",
										"18": "0.6000000238418579",
										"19": "99.8499984741211",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-26 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "4.79",
										"5": "278.7",
										"6": "29.97",
										"7": "31.15",
										"8": "39.31",
										"9": "45.15",
										"10": "2.3399999141693115",
										"11": "2.890000104904175",
										"12": "27.854663848876953",
										"13": "34.58914566040039",
										"14": "90.09288787841797",
										"15": "174.053599609375",
										"16": "50.31999969482422",
										"17": "172.91000366210938",
										"18": "0.6000000238418579",
										"19": "99.94000244140625",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-27 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "5.46",
										"5": "314.2",
										"6": "33.14",
										"7": "34.3",
										"8": "43.82",
										"9": "48.6",
										"10": "1.0800000429153442",
										"11": "1.6399999856948853",
										"12": "27.98200035095215",
										"13": "32.78115463256836",
										"14": "89.32228088378906",
										"15": "105.7035",
										"16": "34.84000015258789",
										"17": "105.01000213623047",
										"18": "0.5",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-28 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "1.95",
										"5": "111.0",
										"6": "33.08",
										"7": "33.4",
										"8": "37.1",
										"9": "38.14",
										"10": "3.3299999237060547",
										"11": "3.940000057220459",
										"12": "30.13114356994629",
										"13": "38.251529693603516",
										"14": "73.79975891113281",
										"15": "244.19319921875",
										"16": "49.40999984741211",
										"17": "243.30999755859375",
										"18": "0.0",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-29 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "4.85",
										"5": "275.5",
										"6": "36.58",
										"7": "37.58",
										"8": "46.05",
										"9": "50.56",
										"10": "6.070000171661377",
										"11": "6.340000152587891",
										"12": "32.06399154663086",
										"13": "43.35980987548828",
										"14": "61.467933654785156",
										"15": "353.301197265625",
										"16": "52.119998931884766",
										"17": "351.260009765625",
										"18": "0.5",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-30 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "5.62",
										"5": "322.3",
										"6": "32.35",
										"7": "33.52",
										"8": "43.38",
										"9": "49.4",
										"10": "4.960000038146973",
										"11": "5.409999847412109",
										"12": "31.87729835510254",
										"13": "41.76985549926758",
										"14": "62.37985610961914",
										"15": "301.568103515625",
										"16": "51.97999954223633",
										"17": "299.7099914550781",
										"18": "0.0",
										"19": "100.0",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-07-31 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "3.36",
										"5": "191.6",
										"6": "34.67",
										"7": "35.62",
										"8": "41.18",
										"9": "46.49",
										"10": "5.840000152587891",
										"11": "6.119999885559082",
										"12": "32.44547653198242",
										"13": "43.404273986816406",
										"14": "60.738037109375",
										"15": "344.463498046875",
										"16": "51.720001220703125",
										"17": "342.2699890136719",
										"18": "0.0",
										"19": "99.80999755859375",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-08-01 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.53",
										"5": "372.6",
										"6": "33.08",
										"7": "34.23",
										"8": "45.98",
										"9": "51.56",
										"10": "4.159999847412109",
										"11": "4.650000095367432",
										"12": "32.241729736328125",
										"13": "42.31676483154297",
										"14": "62.452449798583984",
										"15": "273.4688984375",
										"16": "51.16999816894531",
										"17": "272.30999755859375",
										"18": "0.0",
										"19": "99.93000030517578",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-08-02 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "5.96",
										"5": "342.1",
										"6": "32.67",
										"7": "33.74",
										"8": "44.39",
										"9": "49.9",
										"10": "5.309999942779541",
										"11": "5.900000095367432",
										"12": "33.595855712890625",
										"13": "45.811553955078125",
										"14": "59.384857177734375",
										"15": "328.037201171875",
										"16": "51.380001068115234",
										"17": "326.0899963378906",
										"18": "0.6000000238418579",
										"19": "99.94000244140625",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-08-03 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "7.02",
										"5": "395.2",
										"6": "31.38",
										"7": "32.54",
										"8": "45.27",
										"9": "51.41",
										"10": "5.489999771118164",
										"11": "6.039999961853027",
										"12": "34.521427154541016",
										"13": "48.24542999267578",
										"14": "56.4177131652832",
										"15": "335.599599609375",
										"16": "51.08000183105469",
										"17": "333.69000244140625",
										"18": "0.5",
										"19": "99.98999786376953",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-08-04 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "5.18",
										"5": "301.3",
										"6": "29.39",
										"7": "30.53",
										"8": "39.51",
										"9": "45.44",
										"10": "3.7899999618530273",
										"11": "4.260000228881836",
										"12": "31.856571197509766",
										"13": "42.38471984863281",
										"14": "66.7750473022461",
										"15": "241.1275",
										"16": "50.689998626708984",
										"17": "239.66000366210938",
										"18": "0.5",
										"19": "99.88999938964844",
										"20": "100.0"
									},
									{
										"0": "Phelan50MW",
										"1": "2022-08-05 00:00:00",
										"2": "69.9075",
										"3": "0.0",
										"4": "6.95",
										"5": "394.2",
										"6": "32.48",
										"7": "33.75",
										"8": "46.25",
										"9": "52.33",
										"10": "4.690000057220459",
										"11": "5.210000038146973",
										"12": "32.72865295410156",
										"13": "42.73405456542969",
										"14": "66.1332015991211",
										"15": "298.546197265625",
										"16": "50.22999954223633",
										"17": "297.07000732421875",
										"18": "0.0",
										"19": "99.80999755859375",
										"20": "100.0"
									}
								],
								"schema": [
									{
										"key": "0",
										"name": "Block",
										"type": "string"
									},
									{
										"key": "1",
										"name": "Date",
										"type": "timestamp"
									},
									{
										"key": "2",
										"name": "DC_Capacity",
										"type": "double"
									},
									{
										"key": "3",
										"name": "PVSyst_GHI",
										"type": "double"
									},
									{
										"key": "4",
										"name": "PVSyst_GII",
										"type": "double"
									},
									{
										"key": "5",
										"name": "PVSyst_EGrid",
										"type": "double"
									},
									{
										"key": "6",
										"name": "PVSyst_TAmb_Avg",
										"type": "double"
									},
									{
										"key": "7",
										"name": "PVSyst_TAmb_WtAvg",
										"type": "double"
									},
									{
										"key": "8",
										"name": "PVSyst_TArray_Avg",
										"type": "double"
									},
									{
										"key": "9",
										"name": "PVSyst_TArray_WtAvg",
										"type": "double"
									},
									{
										"key": "10",
										"name": "GHI",
										"type": "double"
									},
									{
										"key": "11",
										"name": "GII",
										"type": "double"
									},
									{
										"key": "12",
										"name": "Tamb",
										"type": "double"
									},
									{
										"key": "13",
										"name": "Tm",
										"type": "double"
									},
									{
										"key": "14",
										"name": "RH",
										"type": "double"
									},
									{
										"key": "15",
										"name": "InvEnergy",
										"type": "double"
									},
									{
										"key": "16",
										"name": "Peak_Power",
										"type": "double"
									},
									{
										"key": "17",
										"name": "ExportEnergy",
										"type": "double"
									},
									{
										"key": "18",
										"name": "ImportEnergyMeter",
										"type": "double"
									},
									{
										"key": "19",
										"name": "PA",
										"type": "double"
									},
									{
										"key": "20",
										"name": "GA",
										"type": "double"
									}
								],
								"truncated": false
							},
							"isSummary": false,
							"language": "scala"
						},
						"persist_state": {
							"view": {
								"type": "details",
								"chartOptions": {
									"chartType": "bar",
									"aggregationType": "sum",
									"categoryFieldKeys": [
										"0"
									],
									"seriesFieldKeys": [
										"2"
									],
									"isStacked": false
								}
							}
						}
					}
				}
			},
			"enableDebugMode": false,
			"kernelspec": {
				"name": "synapse_pyspark",
				"display_name": "Synapse PySpark"
			},
			"language_info": {
				"name": "python"
			},
			"a365ComputeOptions": {
				"id": "/subscriptions/37a47312-6f04-42dc-ad99-290d950fab5d/resourceGroups/AzureSynapse/providers/Microsoft.Synapse/workspaces/sapience/bigDataPools/sapienta",
				"name": "sapienta",
				"type": "Spark",
				"endpoint": "https://sapience.dev.azuresynapse.net/livyApi/versions/2019-11-01-preview/sparkPools/sapienta",
				"auth": {
					"type": "AAD",
					"authResource": "https://dev.azuresynapse.net",
					"authHeader": null
				},
				"sparkVersion": "3.1",
				"nodeCount": 3,
				"cores": 8,
				"memory": 56,
				"extraHeader": null
			},
			"sessionKeepAliveTimeout": 30
		},
		"cells": [
			{
				"cell_type": "markdown",
				"metadata": {
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"**PHELAN DayConslidated Tables with Portfolio Level KPIs**"
				]
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"import pandas as pd \r\n",
					"import datetime\r\n",
					"import numpy as np\r\n",
					"import matplotlib.pyplot as plt\r\n",
					"from pyspark.sql import SparkSession\r\n",
					"from pyspark.sql.types import *\r\n",
					"import pyspark.sql.functions as sf\r\n",
					"from datetime import datetime \r\n",
					"from datetime import date \r\n",
					"from datetime import timedelta\r\n",
					"# from pyspark.sql.functions import to_date\r\n",
					"from datetime import time\r\n",
					"import pytz\r\n",
					"from pathlib import Path\r\n",
					"import pymsteams\r\n",
					"import warnings\r\n",
					"warnings.filterwarnings(\"ignore\")"
				],
				"execution_count": 2
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"pattoreadcsv = \"abfss://phelanrealtime@ayanadatalake.dfs.core.windows.net/phelan_realtime/\"\r\n",
					"LoopCounter=1\r\n",
					"tz = pytz.timezone('Asia/Kolkata')\r\n",
					"todaydate = datetime.date(datetime.now(tz))\r\n",
					"print(todaydate)\r\n",
					"mintime = datetime.min.time()\r\n",
					"DateList =[]\r\n",
					"while LoopCounter <= 1 :\r\n",
					"    DateList.append( datetime.date ( (datetime.combine(todaydate, mintime) - timedelta(days=LoopCounter)) ))\r\n",
					"    LoopCounter += 1\r\n",
					"DateListLength = len(DateList)\r\n",
					"print(DateList)\r\n",
					"TableLoopCounter = 0\r\n",
					"DateLoopCounter = 0"
				],
				"execution_count": 3
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"location1 = pattoreadcsv   \r\n",
					"location1= location1+ str(DateList[DateLoopCounter]).split(\"-\")[0]+\"/\"+str(DateList[DateLoopCounter]).split(\"-\")[1]+\"/\"+str(DateList[DateLoopCounter]).split(\"-\")[2]+\"/\"+str(\"*\")\r\n",
					"print(location1)\r\n",
					"#df = pd.read_parquet(location1)"
				],
				"execution_count": 4
			},
			{
				"cell_type": "markdown",
				"metadata": {
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"**USE BELOW BLOCK IF MANUAL OPERATION IS REQUIRED ANYTIME**"
				]
			},
			{
				"cell_type": "markdown",
				"metadata": {
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					""
				]
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"#df2=  spark.read.load(\"abfss://phelanrealtime@ayanadatalake.dfs.core.windows.net/phelan_realtime/2022/06/29/*\", format='csv', header=True)\r\n",
					"df2 = spark.read.load(location1, format='csv', header=True)\r\n",
					"#display(df)\r\n",
					"df2=df2.toPandas()\r\n",
					"df2"
				],
				"execution_count": 5
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"#df2=pd.read_parquet(location1)\r\n",
					"#df2=pd.read_parquet(\"abfss://repono@ayanadatalake.dfs.core.windows.net/allcsvtoparquet/dt=2022-02-19/part-00000-513a047b-d8be-4f4c-99b7-ee9a7d89a754.c000.snappy.parquet\")\r\n",
					"df2.sort_values(by=\"ISTtime\",ascending=True,inplace=True)\r\n",
					"df2.sort_values(by=\"ISTtime\",ascending=True,inplace=True)\r\n",
					"#df2=df2[df2[\"sitename\"]==|\"ananthpuram\"]\r\n",
					"df2.drop([\"deviceid\",\"quality\",\"timestamp\",\"PartitionId\",\"EventEnqueuedUtcTime\",\"IoTHub\"],axis=1,inplace=True)\r\n",
					"df2[\"ISTtime\"]=df2[\"ISTtime\"].astype(\"datetime64[ns]\")\r\n",
					"df2[\"Date\"]=pd.DatetimeIndex(df2[\"ISTtime\"]).date\r\n",
					"df2[\"Time\"]=pd.DatetimeIndex(df2[\"ISTtime\"]).time\r\n",
					"df2[\"Hour\"]=pd.DatetimeIndex(df2[\"ISTtime\"]).hour\r\n",
					"df2[\"Minute\"]=pd.DatetimeIndex(df2[\"ISTtime\"]).minute\r\n",
					"df2=df2[(df2[\"Hour\"]>=6) & (df2[\"Hour\"]<=19)]\r\n",
					"df2=df2.drop_duplicates()\r\n",
					"df2[\"value\"]=df2[\"value\"].astype(\"float32\")\r\n",
					"df2.head()"
				],
				"execution_count": 6
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df2.drop([\"Date\",\"Time\",\"Hour\",\"Minute\"],axis=1,inplace=True)"
				],
				"execution_count": 7
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df2=df2.copy()\r\n",
					"df2.head()"
				],
				"execution_count": 8
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"x=df2[df2[\"itemname\"]==\"PLANT_TODAY_IMP_KWH\"]\r\n",
					"x"
				],
				"execution_count": 9
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"#df2[\"EventProcessedUtcTime\"][:1].str.split(\"T\")[0]"
				],
				"execution_count": 10
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"pd.Series(str(df2[\"EventProcessedUtcTime\"][:1])).str.split(\"T\")[0][0].split(\" \")[4]"
				],
				"execution_count": 11
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"b1=[]\r\n",
					"Block_name_list=[\"Phelan50MW\"]      \r\n",
					"DC_Capacity_list=[69.9075]\r\n",
					"\r\n",
					"Tm1_list=[\"WMS_MOD_TEMP\"]\r\n",
					"avg_Tm1_list=[]\r\n",
					"final_avg_Tm1_list=[]\r\n",
					"for i in Tm1_list:\r\n",
					"    avg_Tm1_list.append(df2[df2[\"itemname\"]==i][\"value\"].mean())\r\n",
					"max_value_Tm1=max(avg_Tm1_list)\r\n",
					"final_reference_value_Tm1=max_value_Tm1-max_value_Tm1*0.02\r\n",
					"for i in range(len(avg_Tm1_list)):\r\n",
					"    if avg_Tm1_list[i]>=final_reference_value_Tm1:\r\n",
					"        final_avg_Tm1_list.append(avg_Tm1_list[i])\r\n",
					"        \r\n",
					"b1_inv_list=[\"ITC1_INV1_TODAY_KWH\",\"ITC1_INV2_TODAY_KWH\",\"ITC1_INV3_TODAY_KWH\",\"ITC1_INV4_TODAY_KWH\",\"ITC2_INV1_TODAY_KWH\",\"ITC2_INV2_TODAY_KWH\",\"ITC2_INV3_TODAY_KWH\",\"ITC2_INV4_TODAY_KWH\",\"ITC3_INV1_TODAY_KWH\",\"ITC3_INV2_TODAY_KWH\",\"ITC3_INV3_TODAY_KWH\",\"ITC3_INV4_TODAY_KWH\",\"ITC4_INV1_TODAY_KWH\",\"ITC4_INV2_TODAY_KWH\",\"ITC4_INV3_TODAY_KWH\",\"ITC4_INV4_TODAY_KWH\"]\r\n",
					"\r\n",
					"b1.append(Block_name_list[0])\r\n",
					"b1.append(pd.Series(str(df2[\"EventProcessedUtcTime\"][:1])).str.split(\"T\")[0][0].split(\" \")[4])\r\n",
					"b1.append(DC_Capacity_list[0])\r\n",
					"b1.append(df2[df2[\"itemname\"]==\"WMS_GHI_ACC\"][\"value\"].max())\r\n",
					"b1.append(df2[df2[\"itemname\"]==\"WMS_GII_ACC\"][\"value\"].max())\r\n",
					"b1.append(df2[df2[\"itemname\"]==\"WMS_AMB_TEMP\"][\"value\"].mean())\r\n",
					"b1.append(np.mean(final_avg_Tm1_list))\r\n",
					"b1.append(df2[df2[\"itemname\"]==\"WMS_HUMIDITY\"][\"value\"].mean())\r\n",
					"InvEnergy=0\r\n",
					"for i in b1_inv_list:\r\n",
					"    InvEnergy+=df2[df2[\"itemname\"]==i][\"value\"].max()\r\n",
					"    print(InvEnergy)\r\n",
					"b1.append(InvEnergy/1000)\r\n",
					"b1.append(df2[df2[\"itemname\"]==\"PLANT_TODAY_PEAK_KW\"][\"value\"].max())\r\n",
					"b1.append(df2[(df2[\"itemname\"]==\"PLANT_TODAY_EXP_KWH\")][\"value\"].max())\r\n",
					"\r\n",
					"b1.append( (df2[(df2[\"itemname\"]==\"PLANT_TODAY_IMP_KWH\")][\"value\"].max()))\r\n",
					"if str(df2[(df2[\"itemname\"]==\"PLANT_TIME_AVAILABILITY\")][\"value\"].max()) == \"nan\":\r\n",
					"    b1.append(100.00)\r\n",
					"else:\r\n",
					"    b1.append(df2[(df2[\"itemname\"]==\"PLANT_TIME_AVAILABILITY\")][\"value\"].max())\r\n",
					"    \r\n",
					"if str(df2[(df2[\"itemname\"]==\"GRID_TIME_AVAILABILITY\")][\"value\"].max()) == \"nan\":\r\n",
					"    b1.append(100.00)\r\n",
					"\r\n",
					"else:\r\n",
					"    b1.append(df2[(df2[\"itemname\"]==\"GRID_TIME_AVAILABILITY\")][\"value\"].max())"
				],
				"execution_count": 12
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"all_block_list=[]\r\n",
					"all_block_list.append(b1)\r\n",
					"all_block_list"
				],
				"execution_count": 13
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"StaticFile = 'abfss://repono@ayanadatalake.dfs.core.windows.net/Bhdl/Bhdl_StaticData/Bhdl_PVSyst_DayCons.xlsx'\r\n",
					"daily_df=pd.read_excel(StaticFile)\r\n",
					"daily_df.head()"
				],
				"execution_count": 14
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"#daily_df.info()"
				],
				"execution_count": 191
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"columns=[\"Block\",\"Date\",\"DC_Capacity\",\"GHI\",\"GII\",\"Tamb\",\"Tm\",\"RH\",\"InvEnergy\",\"Peak_Power\",\"ExportEnergy\",\"ImportEnergyMeter\",\"PA\",\"GA\"]\r\n",
					"df_main1=pd.DataFrame(all_block_list,columns=columns)\r\n",
					"df_main1['Date'] = df_main1['Date'].astype('datetime64[ns]')\r\n",
					"#df_main1.info()"
				],
				"execution_count": 15
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df_merge=pd.merge(df_main1,daily_df,on=\"Date\",how=\"inner\")\r\n",
					"#df_merge.head()"
				],
				"execution_count": 16
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df_merge.head(5)"
				],
				"execution_count": 17
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df_merge=df_merge[[\"Block_x\",\"Date\",\"DC_Capacity\",\"PVSyst_GHI\",\"PVSyst_GII\",\"PVSyst_EGrid\",\"PVSyst_TAmb_Avg\",\"PVSyst_TAmb_WtAvg\",\"PVSyst_TArray_Avg\",\"PVSyst_TArray_WtAvg\",\"GHI\",\"GII\",\"Tamb\",\"Tm\",\"RH\",\"InvEnergy\",\"Peak_Power\",\"ExportEnergy\",\"ImportEnergyMeter\",\"PA\",\"GA\"]]\r\n",
					"#df_merge.head()"
				],
				"execution_count": 18
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df_merge.rename(columns = {\"Block_x\":\"Block\"}, inplace = True)"
				],
				"execution_count": 19
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df_merge[\"PVSyst_GHI\"] = df_merge[\"PVSyst_GHI\"].astype('float64')"
				],
				"execution_count": 20
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df_merge.fillna(0.0, inplace = True)"
				],
				"execution_count": 21
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"from pyspark.sql.types import StructType,StructField,StringType,DateType,FloatType,LongType,DoubleType,TimestampType"
				],
				"execution_count": 22
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"schema=StructType([StructField(\"Block\",StringType()),\r\n",
					"StructField(\"Date\",TimestampType()),\r\n",
					"StructField(\"DC_Capacity\",DoubleType()),\r\n",
					"StructField(\"PVSyst_GHI\",DoubleType()),\r\n",
					"StructField(\"PVSyst_GII\",DoubleType()),\r\n",
					"StructField(\"PVSyst_EGrid\",DoubleType()),\r\n",
					"StructField(\"PVSyst_TAmb_Avg\",DoubleType()),\r\n",
					"StructField(\"PVSyst_TAmb_WtAvg\",DoubleType()),\r\n",
					"StructField(\"PVSyst_TArray_Avg\",DoubleType()),\r\n",
					"StructField(\"PVSyst_TArray_WtAvg\",DoubleType()),\r\n",
					"StructField(\"GHI\",DoubleType()),\r\n",
					"StructField(\"GII\",DoubleType()),\r\n",
					"StructField(\"Tamb\",DoubleType()),\r\n",
					"StructField(\"Tm\",DoubleType()),\r\n",
					"StructField(\"RH\",DoubleType()),\r\n",
					"StructField(\"InvEnergy\",DoubleType()),\r\n",
					"StructField(\"Peak_Power\",DoubleType()),\r\n",
					"StructField(\"ExportEnergy\",DoubleType()),\r\n",
					"StructField(\"ImportEnergyMeter\",DoubleType()),\r\n",
					"StructField(\"PA\",DoubleType()),\r\n",
					"StructField(\"GA\",DoubleType()),\r\n",
					"])\r\n",
					""
				],
				"execution_count": 23
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df_spark2=spark.createDataFrame(df_merge, schema=schema)"
				],
				"execution_count": 24
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"#spark.sql(\"drop table phelan.phelandayconsolidated\")"
				],
				"execution_count": 201
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"spark.sql(\"create database if not exists phelan\")\r\n",
					"df_spark2.write.format(\"delta\").mode(\"append\").saveAsTable(\"phelan.phelandayconsolidated\")"
				],
				"execution_count": 202
			},
			{
				"cell_type": "markdown",
				"metadata": {
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"## **BELOW CODE IS FOR NOTIFICATIONS**"
				]
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					},
					"collapsed": false
				},
				"source": [
					"df=spark.sql(\"select * from phelan.phelandayconsolidated order by date, Block\")\r\n",
					"display(df)"
				],
				"execution_count": 25
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df1=df.toPandas()\r\n",
					"\r\n",
					"df1[\"Date\"]=df1[\"Date\"].astype(\"datetime64[ns]\")\r\n",
					"#df1.info()\r\n",
					"\r\n",
					"df1[\"Year\"]=pd.DatetimeIndex(df1[\"Date\"]).year\r\n",
					"#df1.head()\r\n",
					"\r\n",
					"df1[\"Month\"]=pd.DatetimeIndex(df1[\"Date\"]).month\r\n",
					"\r\n",
					"df1[\"PVSyst_Egrid_MTD\"]=df1.groupby(by=[\"Block\",\"Year\",\"Month\"])[\"PVSyst_EGrid\"].cumsum()\r\n",
					"df1[\"PVSyst_GII_MTD\"]=df1.groupby(by=[\"Block\",\"Year\",\"Month\"])[\"PVSyst_GII\"].cumsum()\r\n",
					"df1[\"GII_MTD\"]=df1.groupby(by=[\"Block\",\"Year\",\"Month\"])[\"GII\"].cumsum()\r\n",
					"\r\n",
					"df1[\"PVSyst_PR\"]=(df1[\"PVSyst_EGrid\"]/df1[\"DC_Capacity\"])/df1[\"PVSyst_GII\"]\r\n",
					"\r\n",
					"df1[\"Ins.Delta\"]=(df1[\"GII\"]-df1[\"PVSyst_GII\"])/df1[\"PVSyst_GII\"]\r\n",
					"\r\n",
					"#df1[\"YesterdayImportEnergyMeter\"]=df1.sort_values(by=['Block','Date'],ascending=True).groupby(by=[\"Block\"])[\"ImportEnergyMeter\"].shift(1)\r\n",
					"#df1[\"ImportEnergy\"]=df1[\"ImportEnergyMeter\"]-df1[\"YesterdayImportEnergyMeter\"]\r\n",
					"#df1.sort_values(by=['Block','Date'],ascending=True)\r\n",
					"\r\n",
					"\r\n",
					"df1[\"NetEnergy\"]=df1[\"ExportEnergy\"] #sincel import energy tag value are not in right decimal place and need TVM meter chages so accordingly has been ingonred for now\r\n",
					"\r\n",
					"df1[\"AC_Loss\"]=(df1[\"InvEnergy\"]-df1[\"NetEnergy\"])/df1[\"InvEnergy\"]\r\n",
					"\r\n",
					"df1[\"NetEnergy_MTD\"]=df1.groupby(by=[\"Block\",\"Year\",\"Month\"])[\"NetEnergy\"].cumsum()\r\n",
					"\r\n",
					"df1[\"ExpectedEnergy\"]=(df1[\"DC_Capacity\"]*df1[\"GII\"]*df1[\"PVSyst_PR\"]*df1[\"GA\"])/100\r\n",
					"df1[\"ExpectedEnergy_MTD\"]=df1.groupby(by=[\"Block\",\"Year\",\"Month\"])[\"ExpectedEnergy\"].cumsum()\r\n",
					"\r\n",
					"df1[\"EPI\"]=df1[\"NetEnergy\"]/df1[\"ExpectedEnergy\"]\r\n",
					"\r\n",
					"df1[\"SPPr\"]=(df1[\"NetEnergy\"]/df1[\"PVSyst_EGrid\"])*100\r\n",
					"\r\n",
					"df1[\"PR\"]=(((df1[\"NetEnergy\"]/df1[\"DC_Capacity\"])/df1[\"GII\"])/df1[\"GA\"])*10000\r\n",
					"\r\n",
					"df1[\"CUF_DC\"]=(((df1[\"NetEnergy\"]/df1[\"DC_Capacity\"])/24))*100\r\n",
					"\r\n",
					"df1[\"CUF_AC\"]=(df1[\"NetEnergy\"]/50/24)*100\r\n",
					"\r\n",
					"df1[\"Rvnu\"]=df1[\"NetEnergy\"]*2.72/1000\r\n",
					"\r\n",
					"df1[\"Rvnu_MTD\"]=df1.groupby(by=[\"Block\",\"Year\",\"Month\"])[\"Rvnu\"].cumsum()"
				],
				"execution_count": 26
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df1.to_excel(\"abfss://repono@ayanadatalake.dfs.core.windows.net/Bhdl/Bhdl_Insights/Bhdl_Insights_Table1Cons/Bhdl_DayConsolidated_Portfolio.xlsx\")"
				],
				"execution_count": 220
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df2=df1.tail(1)\r\n",
					"df2"
				],
				"execution_count": 27
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"site = \"**Phelan50MW**\"\r\n",
					"x=str(site)+\"\\r\\n\\r\\n\"+\"Today | \"+str(df2.iloc[0,1]).split(\" \")[0]+\"  |  \"+\"Inso.Delta: \"+str(np.round(((df2[\"GII\"].sum()-df2[\"PVSyst_GII\"].sum())/df2[\"PVSyst_GII\"].sum())*100,2))+\"%\"+\"\\n\\n\"+\"BGT: \"+str(np.round(df2[\"PVSyst_EGrid\"].sum(),2))+\"\\r\\n\\r\\n\"+\"EXP: \"+str(np.round(df2[\"ExpectedEnergy\"].sum(),2))+\"\\r\\n\\r\\n\"+\"ACT: \"+str(np.round(df2[\"NetEnergy\"].sum(),2))+\"\\n\\n\"+\"........................\"+\"\\n\\n\"+\"MTD\"+\"  |  \"+\"Inso.Delta: \"+str(np.round(((df2[\"GII_MTD\"].sum()-df2[\"PVSyst_GII_MTD\"].sum())/df2[\"PVSyst_GII_MTD\"].sum())*100,2))+\"%\" + \"\\r\\n\\r\\n\"+\"BGT: \"+str(np.round(df2[\"PVSyst_Egrid_MTD\"].sum(),2))+\"\\r\\n\\r\\n\"+\"EXP: \"+str(np.round(df2[\"ExpectedEnergy_MTD\"].sum(),2))+\"\\r\\n\\r\\n\"+\"ACT: \"+str(np.round(df2[\"NetEnergy_MTD\"].sum(),2))\r\n",
					"x\r\n",
					"import pymsteams\r\n",
					"myTeamsMessage = pymsteams.connectorcard(\"https://ayanapower.webhook.office.com/webhookb2/17435f69-7867-4a41-b5f0-46ceb0fb534f@59b60474-e282-44b5-881c-bb9ce815690c/IncomingWebhook/e9896d8155f142749ea749bb5d8b5f8e/0a64ab19-2984-4746-9447-21882231bb32\")\r\n",
					"myTeamsMessage.text(x)\r\n",
					"myTeamsMessage.send()"
				],
				"execution_count": 30
			},
			{
				"cell_type": "code",
				"metadata": {
					"jupyter": {
						"source_hidden": false,
						"outputs_hidden": false
					},
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					"df2_Phelan=df2[df2[\"Block\"]==\"Phelan50MW\"]\r\n",
					"ml1=list(df2_Phelan.values[0])\r\n",
					"ml2=list(df2.columns)\r\n",
					"msg1=dict(zip(ml2,ml1))\r\n",
					"msg1\r\n",
					"\r\n",
					"x=\"Date: \"+str(msg1[\"Date\"]).split(\" \")[0]+\"\\n\\n\"+\"Block: \"+str(msg1[\"Block\"])+\" | \"+str(np.round(msg1[\"DC_Capacity\"],2))+\"\\n\\n\"+\"PR: \"+str(np.round(msg1[\"PR\"],2))+\"%\"+\"\\n\\n\"+\"CUF_AC: \"+str(np.round(msg1[\"CUF_AC\"],2))+\"\\n\\n\"+\"CUF_DC: \"+str(np.round(msg1[\"CUF_DC\"],2))+\"\\n\\n\"+\"GII: \"+str(np.round(msg1[\"GII\"],2))+\"\\n\\n\"+\"Ins.Delta: \"+str(np.round(msg1[\"Ins.Delta\"],3)*100)+\"%\"+\"\\n\\n\"+\"InvEnergy: \"+str(np.round(msg1[\"InvEnergy\"],2))+\" MWh\"+\"\\n\\n\"+\"Expected Energy: \"+str(np.round(msg1[\"ExpectedEnergy\"],2))+\" MWh\"+\"\\n\\n\"+\"Budgeted: \"+str(np.round(msg1[\"PVSyst_EGrid\"],2))+\" MWh\"+\"\\n\\n\"+\"NetEnergy: \"+str(np.round(msg1[\"NetEnergy\"],2))+\" MWh\"+\"\\n\\n\"+\"PA: \"+str(np.round(msg1[\"PA\"],2))+\"%\"+\"\\n\\n\"+\"GA: \"+str(np.round(msg1[\"GA\"],2))+\"%\"+\"\\n\\n\"+\"Rvnu: \"+str(np.round(msg1[\"Rvnu\"],2))+\" M\"+\"\\n\\n\"+\"Rvnu_MTD: \"+str(np.round(msg1[\"Rvnu_MTD\"],2))+\" M\"\r\n",
					"x\r\n",
					"\r\n",
					"import pymsteams\r\n",
					"myTeamsMessage = pymsteams.connectorcard(\"https://ayanapower.webhook.office.com/webhookb2/17435f69-7867-4a41-b5f0-46ceb0fb534f@59b60474-e282-44b5-881c-bb9ce815690c/IncomingWebhook/1d17e0744935468d85b2eeae552b4f80/0a64ab19-2984-4746-9447-21882231bb32\")\r\n",
					"myTeamsMessage.text(x)\r\n",
					"myTeamsMessage.send()"
				],
				"execution_count": 31
			},
			{
				"cell_type": "markdown",
				"metadata": {
					"nteract": {
						"transient": {
							"deleting": false
						}
					}
				},
				"source": [
					""
				]
			}
		]
	}
}